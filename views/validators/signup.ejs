<script>
  // Confirm password
  const password = document.getElementById("password");
  const confirmPassword = document.getElementById("confirmPassword");

  confirmPassword.addEventListener("input", () => {
    if (password.value !== confirmPassword.value) {
      confirmPassword.setCustomValidity("Passwords don't match");
    } else {
      confirmPassword.setCustomValidity("");
    }
  });

  // Validate firstName
  const firstName = document.getElementById("firstName");
  firstName.addEventListener('input', () => {
    if (firstName.validity.patternMismatch) {
      firstName.setCustomValidity("Only letters are allowed (no spaces)");
    } else {
      firstName.setCustomValidity("");
    }
  })

  // Validate lastName
  const lastName = document.getElementById("lastName");
  lastName.addEventListener('input', () => {
    if (lastName.validity.patternMismatch) {
      lastName.setCustomValidity("Only letters are allowed (no spaces)");
    } else {
      lastName.setCustomValidity("");
    }
  })

  // Validate username
  const username = document.getElementById("username");
  username.addEventListener('input', () => {
    if (username.validity.patternMismatch) {
      username.setCustomValidity("Only letters and numbers are allowed (no spaces)");
    } else {
      username.setCustomValidity("");
    }
  })

  // Check if username is unique
  const siteURL = window.location.origin;
  username.addEventListener('change', async () => {
    const response = await fetch(`${siteURL}/user/check-unique/${username.value}`);
    const data = await response.json();

    if (data.userExisted) {
      username.setCustomValidity('Username already exist');
    } else {
      username.setCustomValidity('')
    }
  })
</script>